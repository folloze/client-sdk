import{a as De}from"./chunk.7KX576SE.js";import{A as G,G as ht,a as q,b as Te,d as Ee,e as m,f as et,k as tt,l as rt,m as P,n as it,o as nt,p as ot,q as R,r as j,s as at,t as ct,v as x,w as st,x as ut,y as dt,z as lt}from"./chunk.YJKVBU6I.js";import{d,e as k}from"./chunk.KVVA2TM3.js";var A=d((hi,$)=>{var ft=P(),pt=q();function _t(r,e,t){(t!==void 0&&!pt(r[e],t)||t===void 0&&!(e in r))&&ft(r,e,t)}$.exports=_t});var N=d((v,p)=>{var mt=Te(),V=typeof v=="object"&&v&&!v.nodeType&&v,L=V&&typeof p=="object"&&p&&!p.nodeType&&p,vt=L&&L.exports===V,z=vt?mt.Buffer:void 0,U=z?z.allocUnsafe:void 0;function bt(r,e){if(e)return r.slice();var t=r.length,i=U?U(t):new r.constructor(t);return r.copy(i),i}p.exports=bt});var W=d((fi,H)=>{var K=nt();function wt(r){var e=new r.constructor(r.byteLength);return new K(e).set(new K(r)),e}H.exports=wt});var Z=d((pi,X)=>{var gt=W();function St(r,e){var t=e?gt(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}X.exports=St});var Y=d((_i,J)=>{function kt(r,e){var t=-1,i=r.length;for(e||(e=Array(i));++t<i;)e[t]=r[t];return e}J.exports=kt});var D=d((mi,B)=>{var qt=m(),Q=Object.create,Pt=function(){function r(){}return function(e){if(!qt(e))return{};if(Q)return Q(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}();B.exports=Pt});var O=d((vi,T)=>{var xt=ot(),At=xt(Object.getPrototypeOf,Object);T.exports=At});var ee=d((bi,E)=>{var Ot=D(),yt=O(),It=R();function Ft(r){return typeof r.constructor=="function"&&!It(r)?Ot(yt(r)):{}}E.exports=Ft});var re=d((wi,te)=>{var Ct=x(),Mt=j();function Rt(r){return Mt(r)&&Ct(r)}te.exports=Rt});var oe=d((gi,ne)=>{var jt=Ee(),Gt=O(),$t=j(),Vt="[object Object]",Lt=Function.prototype,zt=Object.prototype,ie=Lt.toString,Ut=zt.hasOwnProperty,Nt=ie.call(Object);function Kt(r){if(!$t(r)||jt(r)!=Vt)return!1;var e=Gt(r);if(e===null)return!0;var t=Ut.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&ie.call(t)==Nt}ne.exports=Kt});var y=d((Si,ae)=>{function Ht(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}ae.exports=Ht});var se=d((ki,ce)=>{var Wt=P(),Xt=q(),Zt=Object.prototype,Jt=Zt.hasOwnProperty;function Yt(r,e,t){var i=r[e];(!(Jt.call(r,e)&&Xt(i,t))||t===void 0&&!(e in r))&&Wt(r,e,t)}ce.exports=Yt});var de=d((qi,ue)=>{var Qt=se(),Bt=P();function Dt(r,e,t,i){var o=!t;t||(t={});for(var a=-1,c=e.length;++a<c;){var s=e[a],u=i?i(t[s],r[s],s,t,r):void 0;u===void 0&&(u=r[s]),o?Bt(t,s,u):Qt(t,s,u)}return t}ue.exports=Dt});var he=d((Pi,le)=>{function Tt(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}le.exports=Tt});var pe=d((xi,fe)=>{var Et=m(),er=R(),tr=he(),rr=Object.prototype,ir=rr.hasOwnProperty;function nr(r){if(!Et(r))return tr(r);var e=er(r),t=[];for(var i in r)i=="constructor"&&(e||!ir.call(r,i))||t.push(i);return t}fe.exports=nr});var I=d((Ai,_e)=>{var or=lt(),ar=pe(),cr=x();function sr(r){return cr(r)?or(r,!0):ar(r)}_e.exports=sr});var ve=d((Oi,me)=>{var ur=de(),dr=I();function lr(r){return ur(r,dr(r))}me.exports=lr});var qe=d((yi,ke)=>{var be=A(),hr=N(),fr=Z(),pr=Y(),_r=ee(),we=at(),ge=ct(),mr=re(),vr=st(),br=et(),wr=m(),gr=oe(),Sr=ut(),Se=y(),kr=ve();function qr(r,e,t,i,o,a,c){var s=Se(r,t),u=Se(e,t),w=c.get(u);if(w){be(r,t,w);return}var h=a?a(s,u,t+"",r,e,c):void 0,_=h===void 0;if(_){var l=ge(u),S=!l&&vr(u),M=!l&&!S&&Sr(u);h=u,l||S||M?ge(s)?h=s:mr(s)?h=pr(s):S?(_=!1,h=hr(u,!0)):M?(_=!1,h=fr(u,!0)):h=[]:gr(u)||we(u)?(h=s,we(s)?h=kr(s):(!wr(s)||br(s))&&(h=_r(u))):_=!1}_&&(c.set(u,h),o(h,u,i,a,c),c.delete(u)),be(r,t,h)}ke.exports=qr});var Ae=d((Ii,xe)=>{var Pr=tt(),xr=A(),Ar=it(),Or=qe(),yr=m(),Ir=I(),Fr=y();function Pe(r,e,t,i,o){r!==e&&Ar(e,function(a,c){if(o||(o=new Pr),yr(a))Or(r,e,c,t,Pe,i,o);else{var s=i?i(Fr(r,c),a,c+"",r,e,o):void 0;s===void 0&&(s=a),xr(r,c,s)}},Ir)}xe.exports=Pe});var ye=d((Fi,Oe)=>{function Cr(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}Oe.exports=Cr});var Ce=d((Ci,Fe)=>{var Mr=ye(),Ie=Math.max;function Rr(r,e,t){return e=Ie(e===void 0?r.length-1:e,0),function(){for(var i=arguments,o=-1,a=Ie(i.length-e,0),c=Array(a);++o<a;)c[o]=i[e+o];o=-1;for(var s=Array(e+1);++o<e;)s[o]=i[o];return s[e]=t(c),Mr(r,this,s)}}Fe.exports=Rr});var Re=d((Mi,Me)=>{function jr(r){return function(){return r}}Me.exports=jr});var $e=d((Ri,Ge)=>{var Gr=Re(),je=rt(),$r=G(),Vr=je?function(r,e){return je(r,"toString",{configurable:!0,enumerable:!1,value:Gr(e),writable:!0})}:$r;Ge.exports=Vr});var Le=d((ji,Ve)=>{var Lr=800,zr=16,Ur=Date.now;function Nr(r){var e=0,t=0;return function(){var i=Ur(),o=zr-(i-t);if(t=i,o>0){if(++e>=Lr)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}Ve.exports=Nr});var Ue=d((Gi,ze)=>{var Kr=$e(),Hr=Le(),Wr=Hr(Kr);ze.exports=Wr});var Ke=d(($i,Ne)=>{var Xr=G(),Zr=Ce(),Jr=Ue();function Yr(r,e){return Jr(Zr(r,e,Xr),r+"")}Ne.exports=Yr});var We=d((Vi,He)=>{var Qr=q(),Br=x(),Dr=dt(),Tr=m();function Er(r,e,t){if(!Tr(t))return!1;var i=typeof e;return(i=="number"?Br(t)&&Dr(e,t.length):i=="string"&&e in t)?Qr(t[e],r):!1}He.exports=Er});var Ze=d((Li,Xe)=>{var ei=Ke(),ti=We();function ri(r){return ei(function(e,t){var i=-1,o=t.length,a=o>1?t[o-1]:void 0,c=o>2?t[2]:void 0;for(a=r.length>3&&typeof a=="function"?(o--,a):void 0,c&&ti(t[0],t[1],c)&&(a=o<3?void 0:a,o=1),e=Object(e);++i<o;){var s=t[i];s&&r(e,s,i,a)}return e})}Xe.exports=ri});var Ye=d((zi,Je)=>{var ii=Ae(),ni=Ze(),oi=ni(function(r,e,t,i){ii(r,e,t,i)});Je.exports=oi});var Qe=k(De());var f=class{static async bindLiveBoard(e){await import("./mocks.3P3YKP5F.js").then(t=>t.rules(e)).catch(t=>console.error("could not import liveboard mocks",t))}static async bindDesigner(e){await import("./mocks.NM34Y5O6.js").then(t=>t.rules(e)).catch(t=>console.error("could not import designer mocks",t))}static async bindAnalytics(e){await import("./mocks.N2U3N7MB.js").then(t=>t.rules(e)).catch(t=>console.error("could not import analytics mocks",t))}};var Be=k(Ye()),F=k(ht()),ai={organizationId:-1,useMock:!1,isPreview:!1,config:{baseURL:"/",headers:{}},analyticsServiceEndpoint:""},b="folloze-session-guid",C=class{constructor(e){this.handleSuccess=e=>{var t,i;return((t=e.headers)==null?void 0:t.authorization)&&(this.jwt=e.headers.authorization.replace("bearer ","")),((i=e.headers)==null?void 0:i[b])&&(this.sessionGuid=e.headers[b]),e};var i,o;this.useMock=e.useMock,this.options=e,this.organizationId=e.organizationId,e.sessionGuid&&(this.sessionGuid=e.sessionGuid),e.jwt&&(this.jwt=e.jwt),e.flzClientFeature==="embedded"&&(this.isEmbeddedRequest=!0);let t=typeof window!="undefined"&&((i=window.FollozeState.initialState)==null?void 0:i.token)?(o=window.FollozeState.initialState)==null?void 0:o.token:void 0;t&&(this.urlToken=t)}static async create(e){e=(0,Be.default)(ai,e,(i,o)=>o===null?i:void 0);let t=new C(e);return e.useMock?await t.createMockFetcher(e):t.createAxiosFetcher(e),t}async createMockFetcher(e){return await import("./src.H3ILTLVQ.js").then(async t=>{this.createAxiosFetcher(e),this.fetcher.interceptors.response.use(this.handleSuccess,this.MockHandleError),this.mock=new t.default(this.fetcher),await Promise.all([f.bindLiveBoard(this.mock),f.bindDesigner(this.mock),f.bindAnalytics(this.mock)])}).catch(t=>console.error("could not create mock fetcher",t))}withPartialContent(e,t=2e3,i=1,o){return new Promise((a,c)=>{if(i<=0){console.warn("stop retrying partial content"),c("stop retrying");return}new Promise((u,w)=>e(u,w,o)).then(u=>{u.status==206?(console.debug(`retry partial content ${i}`),i=i-1,setTimeout(()=>{a(this.withPartialContent(e,t,i,u.data.guid))},t)):(console.debug("partial content resolved",u.data),a(u.data))}).catch(u=>{console.error("could not finish partial content request",u),c(u)})})}withDisableOnPreview(e){var t;return((t=this.options)==null?void 0:t.isPreview)?new Promise(i=>i({status:200})):e()}setSessionGuid(e){this.sessionGuid=e}handleError(e){var t;switch((0,F.default)(e,"response.status")){case 410:window.location.reload();break}return console.error(`could not complete axios request to: ${(t=e.config)==null?void 0:t.url}`,e.config),Promise.reject(e)}MockHandleError(e){var t;switch((0,F.default)(e,"response.status")){case 410:window.location.reload();break;case 409:return Promise.reject(e)}return(process==null?void 0:process.env)||console.warn(`could not complete mock request to: ${(t=e.config)==null?void 0:t.url}`,e.config),Promise.reject(e)}createAxiosFetcher(e){e.config.headers["X-Requested-With"]="XMLHttpRequest",e.csrfToken&&(e.config.headers["X-CSRF-Token"]=e.csrfToken),this.fetcher=Qe.default.create(e.config),this.fetcher.interceptors.response.use(this.handleSuccess,this.handleError),this.fetcher.interceptors.request.use(t=>{var i,o;return this.sessionGuid&&(t.headers[b]=this.sessionGuid),this.jwt&&(t.headers.Authorization=`Bearer ${this.jwt}`),this.isEmbeddedRequest&&(t.headers["flz-client-feature"]="embedded",((i=t.url)==null?void 0:i.includes(this.options.analyticsServiceEndpoint))||((o=t.url)==null?void 0:o.includes(this.options.pingEndpoint))||(t.withCredentials=!0)),t})}};var ci={attended_event:0,viewed_recording:2},g=class{constructor(e){this.fetchService=e}trackAttendance(e,t){return this.fetchService.withDisableOnPreview(()=>{let i=e==="create"?"post":"put";return this.fetchService.fetcher[i](`${this.fetchService.options.analyticsServiceEndpoint}/live_board/v1/boards/${t.boardId}/attend_activities`,{widget_id:t.widgetId,event_name:t.eventName,guid:t.guid,activity_type:this.getActivityCode(t.activityType)}).catch(o=>{throw console.error("Could not track event attendence",o),o})})}getActivityCode(e){return ci[e]}};var si=(l=>(l[l.viewed_board=1]="viewed_board",l[l.viewed_item=2]="viewed_item",l[l.clicked_on_next_item=3]="clicked_on_next_item",l[l.clicked_on_previous_item=4]="clicked_on_previous_item",l[l.confirmed_cookie_usage=5]="confirmed_cookie_usage",l[l.clicked_on_share_button=6]="clicked_on_share_button",l[l.shared_a_campaign=7]="shared_a_campaign",l[l.liked_an_item=8]="liked_an_item",l[l.clicked_on_cta=9]="clicked_on_cta",l[l.downloaded_an_item=10]="downloaded_an_item",l[l.changed_category=11]="changed_category",l[l.searched_items=12]="searched_items",l))(si||{}),ui=(n=>(n[n.clicked_on_logo=17]="clicked_on_logo",n[n.clicked_on_campaign_preview=18]="clicked_on_campaign_preview",n[n.viewed_design_tab=19]="viewed_design_tab",n[n.viewed_content_tab=20]="viewed_content_tab",n[n.changed_board_privacy_settings=47]="changed_board_privacy_settings",n[n.clicked_on_find_more_images=51]="clicked_on_find_more_images",n[n.clicked_on_search_image=52]="clicked_on_search_image",n[n.clicked_on_upload_an_image=53]="clicked_on_upload_an_image",n[n.uploaded_an_image=54]="uploaded_an_image",n[n.saved_campaign_design=76]="saved_campaign_design",n[n.discarded_campaign_design_changes=77]="discarded_campaign_design_changes",n[n.configured_personalization=261]="configured_personalization",n[n.deleted_personalization=262]="deleted_personalization",n[n.created_new_block=282]="created_new_block",n[n.added_rule=283]="added_rule",n[n.added_items_to_visible_to_everyone=284]="added_items_to_visible_to_everyone",n[n.changed_rule=285]="changed_rule",n[n.changed_block_title=286]="changed_block_title",n[n.saved_personalization_changes=290]="saved_personalization_changes",n[n.discarded_personalization_changes=291]="discarded_personalization_changes",n[n.change_rule_set_priority=292]="change_rule_set_priority",n[n.add_new_section=325]="add_new_section",n[n.add_floating_section=326]="add_floating_section",n[n.delete_section=327]="delete_section",n[n.delete_floating_section=328]="delete_floating_section",n[n.edit_section=329]="edit_section",n[n.publish_board=330]="publish_board",n[n.preview_board=331]="preview_board",n[n.edit_editable_component=332]="edit_editable_component",n[n.add_personalization_rule_from_designer=333]="add_personalization_rule_from_designer",n))(ui||{}),di=class{constructor(e){this.fetchService=e,this.liveEvent=new g(e)}trackLeadBoardView(e){return this.fetchService.withDisableOnPreview(()=>this.fetchService.fetcher.post(`${this.fetchService.options.analyticsServiceEndpoint}/live_board/v2/boards/${e}/lead_views`).catch(t=>{throw console.error("could not track lead board view",t),t}))}trackLeadContentView(e,t,i,o){return this.fetchService.withDisableOnPreview(()=>this.fetchService.fetcher.post(`${this.fetchService.options.analyticsServiceEndpoint}/live_board/v2/content_items/${e}/lead_views`,{guid:i,item_id:o,source_type:t}).catch(a=>{throw console.error("could not track lead item view",a),a}))}trackUserEvent(e,t){return this.fetchService.fetcher.post("/api/v1/tracking",{event:{id:e,data:t,platform:{id:1,name:"App"}}}).catch(i=>{throw console.error("could not track action",i),i})}trackLeadEvent(e,t){return this.fetchService.fetcher.post("/live_board/v1/tracking",{event:{id:e,data:t,platform:{id:2,name:"Campaign"}}}).catch(i=>{throw console.error("could not track action",i),i})}sendPing(e){return this.fetchService.withDisableOnPreview(()=>this.fetchService.fetcher.post(`${this.fetchService.options.pingEndpoint}/pings`,{lead_id:e.leadId,board_id:e.boardId,item_id:e.itemId,content_item_id:e.contentItemId,client_guid:e.guid,analyticsData:e.analyticsData}))}validateSession(){return this.fetchService.withDisableOnPreview(()=>this.fetchService.fetcher.post("/live_board/v1/session_validations").catch(e=>{throw console.error("could not validate session",e),e}))}createSession(){return this.fetchService.withDisableOnPreview(()=>this.fetchService.fetcher.post("/live_board/v1/sessions").catch(e=>{throw console.error("could not create session",e),e})).then(e=>{var i;let t=((i=e.headers)==null?void 0:i[b])||e.data.guid;return this.fetchService.setSessionGuid(t),e})}updateInvitationUsed(e){return this.fetchService.withDisableOnPreview(()=>this.fetchService.fetcher.put(`/live_board/v2/invitation_wrappers/${e}`).catch(t=>{throw console.error("could not update invitation wrapper",t),t}))}sendBeacon(e){var t;if((t=this.fetchService.options)==null?void 0:t.isPreview)return!0;try{let i=`${this.fetchService.options.analyticsServiceEndpoint}/live_board/v1/lead_events`,o=JSON.stringify({events:e});return navigator.sendBeacon(i,o)}catch(i){console.error("could not send beacon",i)}}trackDownloadFile(e,t,i){return new Promise((o,a)=>{this.fetchService.fetcher.post(`${this.fetchService.options.analyticsServiceEndpoint}/live_board/v2/downloads`,{source_type:e,content_item_id:t,item_id:i}).then(()=>{o()}).catch(c=>{console.error("could not track download content",c),a(c)})})}trackDownloadFileV2(e,t,i){return new Promise((o,a)=>{this.fetchService.fetcher.post(`${this.fetchService.options.analyticsServiceEndpoint}/live_board/v2/content_items/${t}/downloads`,{source_type:e,item_id:i}).then(()=>{o()}).catch(c=>{console.error("could not track download content",c),a(c)})})}trackLeadLikeContent(e,t,i){return new Promise((o,a)=>{this.fetchService.fetcher.post(`${this.fetchService.options.analyticsServiceEndpoint}/live_board/v2/likes`,{source_type:e,content_item_id:t,item_id:i}).then(()=>{o()}).catch(c=>{console.error("could not track like content",c),a(c)})})}trackLeadLikeContentV2(e,t,i){return new Promise((o,a)=>{this.fetchService.fetcher.post(`${this.fetchService.options.analyticsServiceEndpoint}/live_board/v2/content_items/${t}/likes`,{source_type:e,item_id:i}).then(()=>{o()}).catch(c=>{console.error("could not track like content",c),a(c)})})}publishLeadEvents(e,t,i){return this.fetchService.withDisableOnPreview(()=>this.fetchService.fetcher.post("/live_board/v2/sphere/publish_lead_events",{content_item_id:e,timestamp:t,event_name:i}).catch(o=>{throw console.error("could not update invitation wrapper",o),o}))}};export{b as a,C as b,si as c,ui as d,di as e};
